---
// STAGE 3 DEBUG: Footer/MobileNav Restored, Header commented
import { ClientRouter } from "astro:transitions";
import { getLangFromUrl, getRouteFromUrl } from "../i18n/utils";
import "../styles/global.css";

// Font Optimizations (Self-hosted)
import "@fontsource-variable/inter";
import "@fontsource-variable/jetbrains-mono";
import "@fontsource-variable/outfit";

import Header from "../components/Header.astro";
import MobileNav from "../components/MobileNav.astro";
import Footer from "../components/Footer.astro";
import SearchModal from "../components/SearchModal.tsx";

// Logic Check
const lang = getLangFromUrl(Astro.url);

interface Props {
  title: string;
  description?: string;
  image?: string;
  type?: "website" | "article";
  publishedTime?: string;
  author?: string;
  keywords?: string;
}

const {
  title,
  description = "Gin's bleeding edge blog exploring AI, software engineering, and technology.",
  image,
  type = "website",
  publishedTime,
  author = "IchimaruGin728",
  keywords = "blog, tech, ai, software engineering, ichimarugin728",
} = Astro.props;

// Construct full URL
const canonicalURL = new URL(
  Astro.url.pathname,
  Astro.site || Astro.url.origin,
);

const ogImage = image || "/og-default.png";
const fullOgImage = new URL(ogImage, Astro.site || Astro.url.origin).href;

const fullTitle = title === "Home" ? "Gin's Blog" : `${title} | Gin's Blog`;
---

<!doctype html>
<html lang={lang} class="dark">
  <head>
    <ClientRouter />
    <meta charset="UTF-8" />
    <title>{fullTitle}</title>
  </head>
  <body>
    <Header />
    <slot />
    <Footer />
    <MobileNav />
    <SearchModal client:only="preact" />
    <div class="hidden">
      <!-- Hidden hydration trigger for Islands if needed -->
    </div>
    <!-- Device Info Collector (Runs once per session) -->
  </body>
</html>
